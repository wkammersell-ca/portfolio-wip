<!DOCTYPE html>
<html>
<head>
    <title>portfolio-wip</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.TimeboxScopedApp",scopeType:"release",WEEKEND_DAYS:[0,6],UNCOMMITTED_SCHEDULE_STATES:[],COMPLETED_SCHEDULE_STATES:["Accepted","Released"],RELEASE_ID:null,DATE_ITR:null,START_DATE:null,END_DATE:null,FEATURES:null,onScopeChange:function(scope){this.callParent(arguments),this.start(scope)},start:function(scope){this.removeAll(),this._myMask=new Ext.LoadMask(Ext.getBody(),{msg:"Loading..."}),this._myMask.show();var timeboxRecord=scope.record.raw;RELEASE_ID=timeboxRecord.ObjectID,START_DATE=new Date(timeboxRecord.ReleaseStartDate),END_DATE=new Date(timeboxRecord.ReleaseDate),DATE_ITR=END_DATE,FEATURES=[],this.loadFeaturesForDate(DATE_ITR)},loadFeaturesForDate:function(date){var snapshotStore=Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["AcceptedLeafStoryPlanEstimateTotal","LeafStoryPlanEstimateTotal","PortfolioItemType","Recycled","ActualStartDate","ActualEndDate","DisplayColor","FormattedID","Name"],autoLoad:!0,listeners:{load:this.onFeaturesLoaded,scope:this},compact:!0,context:this.getContext().getDataContext(),limit:1/0,find:{Release:RELEASE_ID,_TypeHierarchy:"PortfolioItem",__At:date.toISOString()}})},compareFeatures:function(a,b){return null===a.actualEndDate&&null!==b.actualEndDate?1:a.actualEndDate<b.actualEndDate?-1:a.actualEndDate>b.actualEndDate?1:null===a.actualStartDate&&null!==b.actualStartDate?1:a.actualStartDate<b.actualStartDate?-1:a.actualStartDate>b.actualStartDate?1:0},onFeaturesLoaded:function(store,records){if(DATE_ITR==END_DATE){for(var recordItr=0;records.length>recordItr;recordItr++){for(var data=records[recordItr].data,new_feature=!0,x=0;FEATURES.length>x;x++)FEATURES[x].formattedId==data.FormattedID&&(new_feature=!1);if(new_feature){var feature={};feature.formattedId=data.FormattedID,feature.name=data.Name,feature.actualStartDate=""===data.ActualStartDate?null:new Date(data.ActualStartDate),feature.actualEndDate=""===data.ActualEndDate?null:new Date(data.ActualEndDate),feature.displayColor=data.DisplayColor,FEATURES.push(feature)}}FEATURES.sort(this.compareFeatures),console.log(FEATURES)}}});

            Rally.launchApp('CustomApp', {
                name:"portfolio-wip",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
